if(typeof window.reportScriptLoaded>"u"){let n=function(t){console.log(`[DEBUG] ${t}`)},d=function(t){if(t.files&&t.files[0]){const o=new FileReader;o.onload=function(e){u.src=e.target.result,v.style.display="block"},o.readAsDataURL(t.files[0])}},g=function(t){if(t.preventDefault(),console.log("同定分析analyzeImage called"),!c.files||c.files.length===0){i.innerHTML="<p>写真を選択してください。</p>";return}const o=new FormData(l);fetch(l.action,{method:"POST",body:o,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}).then(e=>(console.log("Response status:",e.status),console.log("Response headers:",e.headers),e.json())).then(e=>{console.log("サーバーからの応答:",e),e&&e.content?(i.innerHTML=`<pre>${e.content}</pre>`,p.style.display="inline-block"):(console.error("予期しないデータ構造:",e),i.innerHTML="<p>データの取得に失敗しました。もう一度お試しください。</p>")}).catch(e=>{console.error("エラー:",e),i.innerHTML="<p>エラーが発生しました。もう一度お試しください。</p>"})},y=function(){I.src=u.src,f.style.display="block"},s=function(){f.style.display="none"},h=function(){const t=new FormData;t.append("photo",c.files[0]),t.append("identification_result",i.innerText),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(o){t.append("latitude",o.coords.latitude),t.append("longitude",o.coords.longitude),r(t)},function(o){console.error("位置情報の取得に失敗しました:",o),r(t)}):r(t)},r=function(t){const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch(reportStoreUrl,{method:"POST",body:t,headers:{"X-CSRF-TOKEN":o}}).then(e=>e.json()).then(e=>{console.log("報告が送信されました:",e),alert("報告が正常に送信されました。"),s()}).catch(e=>{console.error("報告の送信中にエラーが発生しました:",e),alert("報告の送信中にエラーが発生しました。もう一度お試しください。")})},B=function(){n("Initializing event listeners"),m.addEventListener("click",function(){n("selectPhotoBtn clicked"),c.click()}),c.addEventListener("change",function(){n("File selected: "+(this.files[0]?this.files[0].name:"No file")),d(this)}),l.addEventListener("submit",g),p.addEventListener("click",y),k.addEventListener("click",s),L.addEventListener("click",h),n("Event listeners initialized")},E=function(){n("Checking elements"),n("selectPhotoBtn: "+(m?"Found":"Not found")),n("photoInput: "+(c?"Found":"Not found")),n("uploadForm: "+(l?"Found":"Not found")),n("analyzeBtn: "+(w?"Found":"Not found"))},a=function(){n("DOMContentLoaded event fired"),E(),B()};var F=n,S=d,P=g,R=y,D=s,T=h,M=r,b=B,z=E,N=a;window.reportScriptLoaded=!0;const u=document.getElementById("preview"),v=document.getElementById("imagePreview"),l=document.getElementById("uploadForm"),i=document.getElementById("result"),c=document.getElementById("photo"),m=document.getElementById("selectPhotoBtn"),w=document.getElementById("analyzeBtn"),p=document.getElementById("reportBtn"),f=document.getElementById("reportModal"),I=document.getElementById("modalPreview"),L=document.getElementById("confirmReportBtn"),k=document.getElementById("cancelReportBtn");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a(),window.previewImage=d,n("Script loaded")}else console.warn("Report script already loaded. Skipping re-initialization.");
