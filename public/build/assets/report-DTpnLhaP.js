const s=document.getElementById("preview"),r=document.getElementById("imagePreview"),c=document.getElementById("uploadForm"),o=document.getElementById("result");document.getElementById("photo");function l(n){if(n.files&&n.files[0]){const t=new FileReader;t.onload=function(e){s.src=e.target.result,r.style.display="block"},t.readAsDataURL(n.files[0])}}function d(){console.log("同定分析analyzeImage called");const n=new FormData(c),t=c.dataset.analyzeUrl;console.log("1"),fetch(t,{method:"POST",body:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}).then(e=>e.json()).then(e=>{console.log("2"),e&&e.choices&&e.choices[0]&&e.choices[0].message?o.innerHTML=`<p>${e.choices[0].message.content}</p>`:(console.error("Unexpected data structure:",e),o.innerHTML="<p>予期しないデータ構造です。管理者に連絡してください。</p>")}).catch(e=>{console.error("Error:",e),o.innerHTML="<p>エラーが発生しました。もう一度お試しください。</p>"})}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("selectPhotoBtn"),t=document.getElementById("photo");n&&t&&n.addEventListener("click",function(){t.click()}),t.addEventListener("change",()=>l(t)),document.getElementById("analyzeBtn").addEventListener("click",d)});window.previewImage=l;
