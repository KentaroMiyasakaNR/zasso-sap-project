if(typeof window.reportScriptLoaded>"u"){let e=function(n){console.log(`[DEBUG] ${n}`)},r=function(n){if(e("previewImage called"),n.files&&n.files[0]){const c=new FileReader;c.onload=function(t){e("FileReader onload called"),p.src=t.target.result,f.style.display="block"},c.readAsDataURL(n.files[0])}},a=function(n){if(e("analyzeImage called"),n.preventDefault(),!o.files||o.files.length===0){d.innerHTML="<p>写真を選択してください。</p>",e("No file selected");return}e("Preparing to send request");const c=new FormData(i);fetch(i.action,{method:"POST",body:c,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}).then(t=>(e("Response received"),t.json())).then(t=>{e("Data parsed"),t&&t.choices&&t.choices[0]&&t.choices[0].message?(d.innerHTML=`<p>${t.choices[0].message.content}</p>`,e("Result displayed")):(console.error("Unexpected data structure:",t),d.innerHTML="<p>予期しないデータ構造です。管理者に連絡してください。</p>",e("Unexpected data structure"))}).catch(t=>{console.error("Error:",t),d.innerHTML="<p>エラーが発生しました。もう一度お試しください。</p>",e("Error occurred: "+t.message)})},u=function(){e("Initializing event listeners"),s.addEventListener("click",function(){e("selectPhotoBtn clicked"),o.click()}),o.addEventListener("change",function(){e("File selected: "+(this.files[0]?this.files[0].name:"No file")),r(this)}),i.addEventListener("submit",a),e("Event listeners initialized")},m=function(){e("Checking elements"),e("selectPhotoBtn: "+(s?"Found":"Not found")),e("photoInput: "+(o?"Found":"Not found")),e("uploadForm: "+(i?"Found":"Not found")),e("analyzeBtn: "+(g?"Found":"Not found"))},l=function(){e("DOMContentLoaded event fired"),m(),u()};var h=e,y=r,v=a,E=u,w=m,B=l;window.reportScriptLoaded=!0;const p=document.getElementById("preview"),f=document.getElementById("imagePreview"),i=document.getElementById("uploadForm"),d=document.getElementById("result"),o=document.getElementById("photo"),s=document.getElementById("selectPhotoBtn"),g=document.getElementById("analyzeBtn");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.previewImage=r,e("Script loaded")}else console.warn("Report script already loaded. Skipping re-initialization.");
